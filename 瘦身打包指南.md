# 文件重命名器瘦身打包指南

## 问题分析
原程序打包后500MB的主要原因：
1. **PyQt6依赖过大**：Qt库本身就很庞大
2. **OCR引擎冗余**：同时包含多个OCR库
3. **未使用的依赖**：rapidocr等未实际使用的库
4. **PyInstaller配置不当**：没有排除不必要的模块

## 瘦身方案

### 1. 依赖优化
- 移除 `rapidocr-onnxruntime`（未使用）
- 保留核心功能依赖
- 使用最小化依赖配置

### 2. PyInstaller配置优化
- 启用 `--strip` 去除调试信息
- 启用 `--upx` 使用UPX压缩
- 设置 `--optimize=2` Python优化级别
- 排除不必要的模块

### 3. 模块排除策略
排除以下不必要的模块：
- 科学计算：numpy, pandas, scipy, sklearn
- 机器学习：tensorflow, torch, jax
- 图像处理：opencv, cv2
- 开发工具：pytest, unittest, IPython
- 网络库：requests, urllib3
- 其他：tkinter, wx, kivy等

## 使用方法

### 方法1：使用优化脚本
```bash
python build_optimized.py
```

### 方法2：手动执行
```bash
pyinstaller --onefile --windowed --name=FileRenamer \
  --clean --optimize=2 --strip --upx-dir=/usr/local/bin \
  --exclude-module=matplotlib --exclude-module=numpy \
  --exclude-module=pandas --exclude-module=scipy \
  --exclude-module=sklearn --exclude-module=tensorflow \
  --exclude-module=torch --exclude-module=onnxruntime \
  --exclude-module=cv2 --exclude-module=opencv \
  --exclude-module=rapidocr --exclude-module=tkinter \
  --exclude-module=wx --exclude-module=kivy \
  --exclude-module=IPython --exclude-module=jupyter \
  --exclude-module=notebook --exclude-module=sphinx \
  --exclude-module=docutils --exclude-module=pytest \
  --exclude-module=unittest --exclude-module=email \
  --exclude-module=http --exclude-module=urllib3 \
  --exclude-module=requests --exclude-module=sqlite3 \
  --exclude-module=xml --exclude-module=html \
  --exclude-module=xmlrpc --exclude-module=multiprocessing \
  --exclude-module=concurrent --exclude-module=asyncio \
  --exclude-module=logging --exclude-module=argparse \
  --exclude-module=getopt --exclude-module=doctest \
  --exclude-module=pdb --exclude-module=profile \
  --exclude-module=cProfile \
  --hidden-import=PyQt6.QtCore \
  --hidden-import=PyQt6.QtWidgets \
  --hidden-import=PyQt6.QtGui \
  --hidden-import=pytesseract \
  --hidden-import=pypdf \
  --hidden-import=docx \
  --hidden-import=chardet \
  --hidden-import=PIL \
  --hidden-import=PIL.Image \
  file_renamer_gui.py
```

## 预期效果
- **原大小**：500MB
- **优化后**：预计100-200MB
- **减少幅度**：60-80%

## 注意事项
1. 确保安装了UPX压缩器：`brew install upx`
2. 打包前清理build和dist目录
3. 测试打包后的程序功能是否正常
4. 如果功能异常，可能需要调整excludes列表

## 进一步优化建议
1. **考虑使用更轻量的GUI框架**：如tkinter（但功能有限）
2. **OCR引擎选择**：只保留pytesseract，移除其他OCR库
3. **模块化设计**：将不常用功能作为插件，按需加载
4. **使用虚拟环境**：避免全局依赖污染

## 故障排除
如果打包失败或程序无法运行：
1. 检查excludes列表是否排除了必要的模块
2. 确认hidden-imports包含了所有必需的依赖
3. 查看PyInstaller的错误日志
4. 逐步减少excludes，找到问题模块
